@page "/LeaveParkhouse"


@using ParkhausKorte.Data
@inject ParkingGarage ParkingGarage

<PageTitle>Ausfahrt</PageTitle>

<style>
    .maschine{
        width: 500px;
        height: 600px;
        border: 2px solid black;
        background-color: grey;
  		padding: 40px;
    }
    .screen{
        width: 200px;
        height: 100px;
        left: 50%;
        background-color: black;
        font-size: 65px;
        color: rgb(57, 255, 20);
        text-align: center;
    }
    .buttonEinfahrtK{
        width: 200px;
        height: 100px;
        border: 2px solid black;
        @(normalParkers > 0 ? "" : "pointer-events:none;filter:brightness(0.6)");
    }
    .buttonEinfahrtD{
        width: 200px;
        height: 100px;
        border: 2px solid black;
        @((seasonParkers > 0) || (parkPrice == 0) ? "" : "pointer-events:none;filter:brightness(0.6)");
    }
    .buttonBezahlen{
        width: 200px;
        height: 100px;
        border: 2px solid black;
        @(parkPrice > 0 ? "" : "pointer-events:none;filter:brightness(0.6)");
    }
    .grid-container {
        margin-top: 40%;
        display: grid;
        grid-template-columns: auto auto;
    }
    .grid-item {
        background-color: black;
        padding: 20px;
        font-size: 30px;
        text-align: center;
    }
</style>

<h1>Ausfahrt</h1>

<div class="maschine">
    <div class="screen" style="margin-left: 100px;">@parkSpace</div>
    <div class="grid-container">
        <button class="grid-iteem buttonBezahlen btn btn-primary" @onclick="payParkingPrice"></button>
        <div class="grid-iteem screen">@parkPrice</div>
        <button class="grid-iteem buttonEinfahrtK btn btn-primary" @onclick="subtractNormalParker" >Dauerparker @seasonParkers</button>
        <button class="grid-iteem buttonEinfahrtD btn btn-primary" @onclick="subtractSeasonParker">Kurzparker @normalParkers</button>
    </div>
</div>

@code
{
    int parkerId = 0;
    int parkingSpaces = 0;
    int freeArbitrarySpaces = 0;
    int freeSeasonSpaces = 0;
    int normalParkers = 0;
    int seasonParkers = 0;
    int parkSpace = 0;
    float parkPrice = 0;

    protected override void OnInitialized()
    {
        parkingSpaces = ParkingGarage.availableParkingSpaces;
        UpdateValues();
    }
    private void subtractNormalParker()
    {
        if (ParkingGarage.getCurrentNormalParkers() > 0)
        {
            parkerId = ParkingGarage.RemoveParkerOfType(ParkerType.normal);
            parkPrice = GetParkPrice();
        }
        UpdateValues();
    }
    private void subtractSeasonParker()
    {
        if (ParkingGarage.getCurrentSeasonParkers() > 0)
        {
            parkerId = ParkingGarage.RemoveParkerOfType(ParkerType.season);
        }
        UpdateValues();
    }
    private void payParkingPrice(){
        parkPrice = 0;
        parkerId = 0;
        UpdateValues();
    }
    private int GetFreeArbitrarySpaces() 
    {
        freeArbitrarySpaces = ParkingGarage.GetFreeSpaces();
        return freeArbitrarySpaces;
    }

    private int GetFreeSeasonSpaces() 
    {
        int reservedSeasonParkingSpaces = ParkingGarage.parkingGarageService.getReservedSeasonParkingSpaces();
        int seasonParkers = ParkingGarage.getCurrentSeasonParkers();
        if (seasonParkers < reservedSeasonParkingSpaces) {
            freeSeasonSpaces = ParkingGarage.GetFreeSpaces() + (reservedSeasonParkingSpaces - seasonParkers);
        } else {
            freeSeasonSpaces = ParkingGarage.GetFreeSpaces();
        }
        
        return freeSeasonSpaces;
    }

    private int GetNormalParkers() 
    {
        normalParkers = ParkingGarage.getCurrentNormalParkers();
        return normalParkers;
    }

    private int GetSeasonParkers() 
    {
        seasonParkers = ParkingGarage.getCurrentSeasonParkers();
        return seasonParkers;
    }
    private float GetParkPrice() 
    {
        parkPrice = ParkingGarage.getParkingCost(parkerId);
        return parkPrice;
    }
    protected void UpdateValues()
    {
        GetFreeArbitrarySpaces();
        GetFreeSeasonSpaces();
        GetNormalParkers();
        GetSeasonParkers();
        
    }
}